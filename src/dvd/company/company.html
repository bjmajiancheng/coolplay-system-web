<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>企业注册信息</title>
</head>
<body>
<h2 style="font-size: 25px; margin: 15px;" class="align_center">企业注册信息</h2>
<div class="super-theme-example">
    <form id="companyDetailForm" method="post">
        <input type="hidden" name="id">
        <div class="form-item col-md-5">
            <label class="label-top">公司名称：</label>
            <input id="companyDetail_companyName" name="companyName" class="easyui-validatebox easyui-textbox" prompt="请输入公司名称" data-options="required:true, missingMessage:'请输入公司名称'">
        </div>

        <div class="form-item col-md-5">
            <label class="label-top">联系人：</label>
            <input id="companyDetail_contactName" name="contactName" class="easyui-validatebox easyui-textbox" prompt="请输入联系人" data-options="required:true, missingMessage:'请输入联系人'">
        </div>

        <div class="form-item col-md-5">
            <label class="label-top">电话：</label>
            <input id="companyDetail_contactMobile" name="contactMobile" class="easyui-validatebox easyui-textbox" prompt="请输入电话" data-options="required:true, missingMessage:'请输入电话'">
        </div>

        <div class="form-item col-md-5">
            <label class="label-top">地址：</label>
            <input id="companyDetail_contactAddress" name="contactAddress" class="easyui-validatebox easyui-textbox" prompt="请输入地址" data-options="required:true, missingMessage:'请输入地址'">
        </div>

        <div class="form-item col-md-5">
            <label class="label-top">主营项目：</label>
            <input id="companyDetail_majorProject" name="majorProject" class="easyui-validatebox easyui-textbox" prompt="请输入主营项目" data-options="required:true, missingMessage:'请输入主营项目'">
        </div>

        <div class="form-item col-md-5">
            <label class="label-top">法人身份证号码：</label>
            <input id="companyDetail_legalIdcard" name="legalIdcard" class="easyui-validatebox easyui-textbox" prompt="请输入法人身份证号码" data-options="required:true, missingMessage:'请输入法人身份证号码'">
        </div>

        <div class="form-item col-md-10" style="height:300px;">
            <label class="label-top">公司简介：</label>

            <input type="hidden" name="companyDesc"/>

            <div class="easyui-texteditor" id="companyDetail_companyDescDiv" title="公司简介" style="width:90%;height:300px;padding:20px;left:126px;top:0px;">

            </div>
            <!--<input id="companyDetail_companyDesc" name="companyDesc" class="easyui-validatebox easyui-textbox" prompt="请输入公司简介" data-options="required:true, missingMessage:'请输入公司简介'">-->
        </div>

        <div class="form-item col-md-5">
            <label class="label-top" style="float:left;">营业执照附件：</label>
            <div id="businessLicenseUrlDiv" style="float:left;">
            </div>
        </div>

        <div class="form-item col-md-10">
            <label class="label-top" style="float:left;">身份证正反面照片：</label>
            <div id="idcardPositivePhotoDiv" style="float:left;">
            </div>

            <div id="idcardNegativePhotoDiv" style="float:left;margin-left:10px;">
            </div>
        </div>

        <div class="clear"></div>

        <div class="form-item col-md-10 align_center">
            <a href="javascript:void(0)" onclick="updateCompany()" class="easyui-linkbutton primary">提交修改</a>
        </div>
    </form>
</div>

<script type="text/javascript">
    ;(function ($, window, document, undefined){
        App.getRequestData('/api/common/company/companyInfo', {}, function(data) {
            $("#companyDetailForm").find("input[name=id]").val(data.id);
            $("#companyDetail_companyName").textbox('setValue', data.companyName);
            $("#companyDetail_contactName").textbox('setValue', data.contactName);
            $("#companyDetail_contactMobile").textbox('setValue', data.contactMobile);
            $("#companyDetail_contactAddress").textbox('setValue', data.contactAddress);
            $("#companyDetail_majorProject").textbox('setValue', data.majorProject);
            //$("#companyDetail_companyDesc").textbox('setValue', data.companyDesc);
            $("#companyDetail_companyDescDiv").texteditor('setValue', data.companyDesc);
            $("#companyDetail_legalIdcard").textbox('setValue', data.legalIdcard);

            $("#businessLicenseUrl").attr('value', data.businessLicenseUrl);
            $("#idcardPositivePhoto").attr('value', data.idcardPositivePhoto);
            $("#idcardNegativePhoto").attr('value', data.idcardNegativePhoto);

            App.showImage("businessLicenseUrlDiv", data.businessLicenseUrl);
            App.showImage("idcardPositivePhotoDiv", data.idcardPositivePhoto);
            App.showImage("idcardNegativePhotoDiv", data.idcardNegativePhoto);
        });

        $('#companyDetailForm').form({
            url: App.href + '/api/common/company/updateCompany',
            method: 'POST',
            onSubmit:function(){
                return $(this).form('validate');
            },
            success:function(data){
                var obj = JSON.parse(data);
                if (obj.code == 200) {
                    App.showMsg('保存成功');
                } else {
                    App.showMsg(obj.message);
                }
            }
        });


        var positiveEle = App.uploadImage({id: "idcardPositivePhoto", name: 'idcardPositivePhoto', isAjaxUpload: true, autoUpload: true});
        $('#idcardPositivePhotoDiv').append(positiveEle);

        var negativeEle = App.uploadImage({id: "idcardNegativePhoto", name: 'idcardNegativePhoto', isAjaxUpload: true, autoUpload: true});
        $('#idcardNegativePhotoDiv').append(negativeEle);

        var businessLicenseUrlEle = App.uploadImage({id:"businessLicenseUrl", name: 'businessLicenseUrl', isAjaxUpload: true, autoUpload: true});
        $('#businessLicenseUrlDiv').append(businessLicenseUrlEle);

    })(jQuery, window, document);

    function updateCompany() {
        var idcardPositivePhoto = $("#companyDetailForm").find("input[name=idcardPositivePhoto]").val();
        var idcardNegativePhoto = $("#companyDetailForm").find("input[name=idcardNegativePhoto]").val();
        var businessLicenseUrl = $("#companyDetailForm").find("input[name=businessLicenseUrl]").val();
        var companyDescVal = $("#companyDetail_companyDescDiv").texteditor('getValue');

        $("#companyDetailForm").find("input[name=companyDesc]").val(companyDescVal);

        if(idcardPositivePhoto == undefined || idcardPositivePhoto == '') {
            App.showMsg('请上传身份证正面图片');
            return false;
        }

        if(idcardNegativePhoto == undefined || idcardNegativePhoto == '') {
            App.showMsg('请上传身份证反面图片');
            return false;
        }

        if(businessLicenseUrl == undefined || businessLicenseUrl == '') {
            App.showMsg('请上传营业执照附件图片');
            return false;
        }

        if(companyDescVal == undefined || companyDescVal == '') {
            App.showMsg('请输入公司简介');
            return false;
        }

        $("#companyDetailForm").submit();
    }

</script>
</body>
</html>